<!--Начальная дата разработки 18.07.2025 г.-->
<!--Разработка: Пулин -->
<!--Контекст печати:  -->
<!--Задача:  -->

<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>clientBanner</title>
<!-- @formatter:off -->
{: setPageSize('A4')}
{: setOrientation('P')}
{: setTopMargin(5)}
{: setBottomMargin(5)}
{: setRightMargin(17)}
{: setLeftMargin(17)}

{: from library.Utils import forceString }
{: from library.Utils import forceInt }
{: from PyQt4 import QtGui }
{: db = QtGui.qApp.db }

{: month = [u'a', u'января', u'февраля', u'марта', u'апрель', u'мая', u'июня', u'июля', u'августа', u'сентября', u'октября', u'ноября', u'декабря']}

{:
write('''
<style>
.h1 {
    text-align: center;
    margin-bottom: 20px;
    font-size: 14pt;
    font-weight: 900;
}
.main {
    font-family: 'Arial';
    font-size: 10pt;
}
.small {
  font-size: 8pt;
}
.bold {
  font-weight: 900;
}
.red-line {
  text-indent: 10px;
}
.white-wrap {
  white-space: nowrap;
}

.red-color {
    color: #CC0000;
}
.green-color {
    color: #336600;
}
.blue-color {
    color: #0000FF;
}
</style>
''')}
<!-- @formatter:on -->
</head>
<body>

<div class="main">
  <div>
      <b>{client.fullName}</b>,
      дата рождения: <b>{client.birthDate}</b> ({client.age})
      пол: <b>{client.sex}</b>
      код: <b class="blue-color">{client.id}</b>

{:
soc_status_ref_list = db.getRecordList(stmt=u"""
  select rbSC.name as soc_class,
         GROUP_CONCAT(
                 CONCAT_WS(' ', rbST.code, rbST.name)
                 separator ', '
         )         as soc_type
  from ClientSocStatus css
           join rbSocStatusClass rbSC on css.socStatusClass_id = rbSC.id and css.deleted = 0
           join rbSocStatusType rbST on css.socStatusType_id = rbST.id
  where css.client_id = {clientId}
    and rbSC.id = 1
  group by rbSC.id;
""".format(clientId=client.id))
}
{if: soc_status_ref_list}
    статус:
    {for: ref in soc_status_ref_list}
      <b>{forceString(ref.value(u'soc_class'))}:</b>
      <b>{forceString(ref.value(u'soc_type'))}</b>;
    {end:}
{end:}

    <!--<i>Квоты</i>:-->
    СНИЛС: <b>{client.SNILS}</b>
  </div>

  <div>
{:
client_attach_ref = db.getRecordEx(stmt=u"""
  select rbAT.name   as attact_type,
         o.shortName as organistion_name,
         os.code     as orgstructure_code
  from ClientAttach ca
         left join rbAttachType rbAT on ca.attachType_id = rbAT.id  and ca.deleted = 0
         left join Organisation o on ca.LPU_id = o.id  and o.deleted = 0
         left join OrgStructure os on ca.orgStructure_id = os.id  and os.deleted = 0
  where ca.client_id = {clientId};
""".format(clientId=client.id))
}
    Прикрепление:
    {if: client_attach_ref}
        <span class="bold green-color">
          {forceString(client_attach_ref.value(u'attact_type'))}
          ({forceString(client_attach_ref.value(u'organistion_name'))})
          ({forceString(client_attach_ref.value(u'orgstructure_code'))})
        </span>
    {end:}
  </div>

  <div>
    Документ: <b>{client.document}</b>

    Полис ОМС:
    <!-- Проверяю, существует ли дата окончания или дата начала действия полиса -->
    {if: (client.compulsoryPolicy.endDate) or (client.compulsoryPolicy.begDate)}
        {: flag_compul = 1}
    {else:}
        {: flag_compul = 0}
    {end:}
    <span class="bold {u'green-color' if client.compulsoryPolicy.endDate > currentDate else u'red-color'}">
      {if: client.compulsoryPolicy.policyKind.regionalCode}
          [{client.compulsoryPolicy.policyKind.regionalCode}]
      {end:}
      {client.compulsoryPolicy.serial} {client.compulsoryPolicy.number}

      {if: client.compulsoryPolicy.insurer}
          выдан {client.compulsoryPolicy.insurer}
      {end:}

      <!-- Если существует дата начала или окончания, то выводить "действителен с .. по .." -->
      {if: flag_compul == 1}
          действителен с {client.compulsoryPolicy.begDate} по {client.compulsoryPolicy.endDate}
      {end:}
    </span>
  </div>

  <div>
    Адрес регистрации: <b>{client.regAddress}</b>
  </div>
  <div>
    Адрес проживания: <b>{client.locAddress}</b>
  </div>

  <div>
    Занятость: <b>{client.work.freeInput}</b>
  </div>

  <div>
    Телефоны:
    {for: item in client.contacts}
      {if: len(item) > 1}
          <b>{item[1]}</b>
      {end:}
      {if: len(item) > 2}
          <b>{item[2]}</b>
      {end:}
    {end:}
  </div>

  <div>
    Место рождения: <b>{client.birthPlace}</b>
  </div>
  <div>
    Примечания: <b>{client.notes}</b>
  </div>

  <div>
{:
clientIdentificationRef = db.getRecordEx(stmt=u"""
  select DATE_FORMAT(checkDate, '%d.%m.%Y') as date
  from ClientIdentification ci
  where ci.client_id = {clientId}
  order by ci.id desc
  limit 1;
""".format(clientId=client.id))
}

    Дата подтверждения ЕИС:
    {if: clientIdentificationRef}
        <b>{forceString(clientIdentificationRef.value(u'date'))}</b>
    {end:}
  </div>

  <div>
{:
client_info_ref = db.getRecordEx(stmt=u"""
  select DATE_FORMAT(c.createDatetime, '%d.%m.%Y') as chartBeginDate
  from Client c
  where id = {clientId};
""".format(clientId=client.id))
}

    Дата регистрации пациента в МИС:
    {if: client_info_ref}
        <b>{forceString(client_info_ref.value(u'chartBeginDate'))}</b>
    {end:}
  </div>

  <div>
    Выписка пациента:
  </div>

  <div>
    Код диспансеризации:
  </div>

  <div>
    Дата:
  </div>

  <div>
    Код МО, проводивший диспансеризацию/профосмотр:
  </div>
  <div>
    Причины открепления:
  </div>

</div>
</body>
</html>