<!-- Справка для получения путевки на санаторно-курортное лечение  -->

<!-- изменил Пулин дата 01.09.2025 задача  -->


<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Справка СКЛ</title>
<!-- @formatter:off -->
{: setPageSize('A4')}
{: setOrientation('P')}
{: setTopMargin(5)}
{: setBottomMargin(5)}
{: setRightMargin(17)}
{: setLeftMargin(17)}

{: from library.Utils import forceString }
{: from library.Utils import forceInt }
{: from PyQt4 import QtGui }
{: db = QtGui.qApp.db }

{: month = [u'a', u'января', u'февраля', u'марта', u'апрель', u'мая', u'июня', u'июля', u'августа', u'сентября', u'октября', u'ноября', u'декабря']}

{:
write('''
<style>
.h1 {
    text-align: center;
    margin-bottom: 20px;
    font-size: 14pt;
    font-weight: 900;
}
.main {
    font-family: 'Times New Roman';
    font-size: 10pt;
}
.normal {
    font-size: 10pt;
}
.small {
  font-size: 8pt;
}
.xs {
  font-size: 6pt;
}
.white-wrap {
  white-space: nowrap;
}

</style>
''')}


{:
def render_line(str, base_length = 95):
  return u'_' * (base_length - len(str))
}

<!-- @formatter:on -->
</head>
<body>

<div class="main">
  <header class="header">
    <table width="100%" cellpadding="0" cellspacing="0">
      <tr>
        <td valign="top" class="small">
          <div class="white-wrap">
            Наименование и адрес медицинской организации
          </div>
          <div class="white-wrap">
            {currentOrganisation.shortName} <br>
            {currentOrganisation.address} <br>
            т/ф {currentOrganisation.phone}
          </div>
          <div class="white-wrap">
            ИНН {currentOrganisation.INN},
            КПП {currentOrganisation.KPP},
            ОГРН {currentOrganisation.OGRN},
            ОКПО {currentOrganisation.OKPO}
          </div>
        </td>
        <td></td>
        <td valign="top" class="small">
          <div class="white-wrap">Медицинская документация</div>
          <div class="white-wrap">Учетная форма № 070/у</div>
          <div class="white-wrap">Утверждена приказом Министерства <br> здравоохранения Российской Федерации</div>
          <div class="white-wrap">от 13 мая 2025 г. № 274н</div>
        </td>
      </tr>
    </table>
  </header>

  <br>

  <div align="center" class="h1">
    <div>
      <div>
          Справка № {'_' * 10} <br>
           для получения путевки на санаторно-курортное лечение
      </div>
      <div align="center" class="normal">
        «____» ______ 20____г.
      </div>
    </div>

  </div>



  <p>
    Настоящая справка не заменяет санаторно-курортной карты и не дает права на санаторно-курортное лечение. Справка действительна в течение 12 месяцев
  </p>

  <div>
    Фамилия, имя, отчество (при наличии) ребенка <b>{client.fullName}</b>
  </div>

  <div>
    Дата рождения:
    <b>«{forceString(client.birthDate.toString('dd'))}» {forceString(month[client.birthDate.date.month()])} {forceString(client.birthDate.date.year())} г.</b>
    Пол: <span class="xs">муж. – 1, жен. – 2</span>  <b>{1 if client.sex == u'М' else 2}</b>
  </div>

<!-- note Регистрация по месту -->
{:
def check_city(city):
  return (city and city.socr and (city.socr.strip() == "г." or city.socr.strip() == "г"))
}

{:
def get_district(district):
  if district:
    dst = district.strip()
    if dst.endswith('р-н'):
      return dst[:-3]
    elif dst.endswith('р-н.'):
      return dst[:-4]
  return None
}

<div>
  Регистрация по месту жительства: субъект Российской Федерации <b>{client.regAddress.region.name}</b>
</div>
<div>
  {: isToRenderAddrString = True}
  <div>
    {: dst = get_district(client.regAddress.district)}
    {if: dst} район <b>{dst}</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  {: isToRenderAddrString = False} {end:}
    {if: check_city(client.regAddress.parentCity)} город <b>{client.regAddress.parentCity.name}</b> {: isToRenderAddrString = False}{end:}
    {if: client.regAddress.city}населенный пункт <b>{client.regAddress.city.name}</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {: isToRenderAddrString = False}{end:}
  </div>

  <div>
    {if: client.regAddress.street} улица <b>{client.regAddress.street.name}</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {: isToRenderAddrString = False}{end:}
    {if: client.regAddress.number} дом <b>{client.regAddress.number}</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {: isToRenderAddrString = False}{end:}
    {if: client.regAddress.flat} квартира <b>{client.regAddress.flat}</b> {: isToRenderAddrString = False}{end:}
  </div>

  <!-- note на случай, если адрес введен в виде строки, а не с использованием КЛАДР -->
  {if: isToRenderAddrString}
      <b>{client.regAddress}</b>
  {end:}
</div>



<div>
  Регистрация по месту пребывания: субъект Российской Федерации <b>{client.locAddress.region}</b>
</div>
<div>
  {: isToRenderAddrString = True}
  <div>
    {: dst = get_district(client.locAddress.district)}
    {if: dst} район <b>{dst}</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  {: isToRenderAddrString = False} {end:}
    {if: check_city(client.locAddress.parentCity)} город <b>{client.locAddress.parentCity.name}</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  {: isToRenderAddrString = False}{end:}
    {if: client.locAddress.city}населенный пункт <b>{client.locAddress.city.name}</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {: isToRenderAddrString = False}{end:}
  </div>

  <div>
    {if: client.locAddress.street} улица <b>{client.locAddress.street.name}</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {: isToRenderAddrString = False}{end:}
    {if: client.locAddress.number} дом <b>{client.locAddress.number}</b> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {: isToRenderAddrString = False}{end:}
    {if: client.locAddress.flat} квартира <b>{client.locAddress.flat}</b> {: isToRenderAddrString = False}{end:}
  </div>
  {if: isToRenderAddrString}
      <b>{client.locAddress}</b>
  {end:}
</div>
<!-- note END Регистрация по месту -->

  <div>
    Полис обязательного медицинского страхования
    серия <b>{client.policy.serial}</b>
    № <b>{client.policy.number}</b>
  </div>

  <div>
    дата выдачи полиса обязательного медицинского страхования:
    {if: client.policy.begDate}
      <b>«{forceString(client.policy.begDate.toString('dd'))}» {forceString(month[client.policy.begDate.date.month()])} {forceString(client.policy.begDate.date.year())} г.</b>
    {else:}
      «____» ______ 20____г.
    {end:}

  </div>

  <div>
    данные о страховой медицинской организации, выбранной застрахованным лицом или определенной застрахованному лицу:
    {client.compulsoryPolicy.insurer}
  </div>

{:
kladr_ref = db.getRecordEx(stmt=u"""
  select LEFT(ah.KLADRCode, 2) as region_code
  from ClientAddress ca
           join Address a on ca.address_id = a.id and ca.deleted = 0 and ca.client_id = {clientId}
           join AddressHouse ah on a.house_id = ah.id and ah.deleted = 0
  limit 1;
""".format(clientId=client.id))

if kladr_ref:
    region_code = forceString(kladr_ref.value(u'region_code'))
else:
    region_code = ''
}

    <div>
      Код субъекта Российской Федерации
      <b>{region_code}</b>
    </div>

    <div>
      Климат в месте проживания пациента (код)
      {if: sanCurCardAct}
        <b>{sanCurCardAct[u'Климат в месте проживания']}</b>
      {else:}
        <b>05</b>
      {end:}
    </div>
    <div>
      Климатические факторы в месте проживания пациента (код)
      {if: sanCurCardAct}
        <b>{sanCurCardAct[u'Климатические факторы на месте проживания']}</b>
      {else:}
        <b>08</b>
      {end:}
    </div>
    <div>
      Код меры социальной поддержки
      {if: sanCurCardAct}
        <b>{sanCurCardAct[u'Код льготы']}</b>
      {end:}
    </div>
    <div>
      Сопровождение: <span class="small">да – 1, нет – 2</span>
      {if: sanCurCardAct}
        <b>{sanCurCardAct[u'Необходимость сопровождения пациента']}</b>
      {end:}
    </div>

    <div>Документ, подтверждающий право на получение мер социальной поддержки в виде набора социальных услуг:</div>

    <div>
      серия
      {if: sanCurCardAct}
          <b>{sanCurCardAct[u'Серия документа, удостоверяющего право на получение набора социальных услуг']}</b>  <!-- todo -->
      {end:}
      номер
      {if: sanCurCardAct}
          <b>{sanCurCardAct[u'Номер документа, удостоверяющего право на получение набора социальных услуг']}</b>   <!-- todo -->
      {end:}
      дата выдачи
      {if: sanCurCardAct}
          <b>{sanCurCardAct[u'Дата выдачи документа']}</b>    <!-- todo -->
      {end:}
    </div>

    <div>
      Страховой номер индивидуального лицевого счета: <b>{client.SNILS}</b>
    </div>

{:
def diag_layout(type, mkd_id='', mkb_name=''):
    return """
      <tr>
        <td width="98%">
          {type}
          <b>{mkb_name}</b>
        </td>
        <td class="white-wrap" width="1%">код по МКБ </td>
        <td class="white-wrap" width="1%"><b>{mkd_id}&nbsp;</b></td>
      </tr>
    """.format(type=type, mkd_id=mkd_id, mkb_name=mkb_name)
}

    <div>
      Диагноз заболевания, для лечения которого направляется в санаторно-курортную организацию: {'_' * 20}
      код по Международной статистической классификации болезней и проблем, связанных со здоровьем (далее - МКБ) {'_' * 20}
    </div>

    <table width="100%" cellpadding="0" cellspacing="0">

      {write(diag_layout(u'Сопутствующие заболевания:', u'______', u''))}

      {write(diag_layout(u'Заболевание, являющееся причиной инвалидности:', u'______', u''))}
    </table>

  <br>

    <table width="100%" cellpadding="3" cellspacing="0" border="1">
      <tr>
        <td align="center">Противопоказания для санаторно-курортного лечения отсутствуют</td>
      </tr>
    </table>

  <br>
  <div>
    Рекомендуемое лечение: в условиях пребывания в санаторно-курортной организации - 1; амбулаторно - 2
  </div>

  <br>

  <table width="100%" cellpadding="3" cellspacing="0" border="1">
    <tr>
      <td width="1%" class="white-wrap" valign="middle">Предпочтительное место лечения&nbsp;</td>
      <td valign="middle" align="center">
          &nbsp;
      </td>
    </tr>
  </table>

  <div>
    Рекомендуемые сезоны лечения: зима - 1, весна - 2, лето - 3, осень - 4
  </div>

  {: BASE_LENGTH = 80}
  <table width="100%" cellpadding="0" cellspacing="0">
    <tr>
      <td>
        Лечащий врач, должность врача-специалиста
        {render_line(u'Лечащий врач, должность врача-специалиста', BASE_LENGTH)}
      </td>
      <td width="1%" class="white-wrap">
        {'_' * 10}&nbsp;
      </td>
    </tr>
    <tr>
      <td>
        Заведующий отделением
        {render_line(u'Заведующий отделением', BASE_LENGTH)}
      </td>
      <td width="1%" class="white-wrap">
        <div class="white-wrap">{'_' * 10}&nbsp;</div>
      </td>
    </tr>
    <tr>
      <td>
        Председатель врачебной комиссии
        {render_line(u'Председатель врачебной комиссии', BASE_LENGTH)}
      </td>
      <td width="1%" class="white-wrap">{'_' * 10}&nbsp;</td>
    </tr>
  </table>
  <p>М.П. (при наличии)</p>
</div>
</body>
</html>
