<!-- изменил Пулин дата 22.07.2025 задача  -->
<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Контроль качества</title>
  <style>
    .main {
        font-family: 'Arial';
        font-size: 11pt;
    }
    table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
    }
    .center {
        text-align: center;
    }
    .header {
        text-align: center;
        font-weight: bold;
    }
    .white-wrap {
      white-space: nowrap;
    }

    .section {
        page-break-inside: avoid;
    }
    .section:not(:last-child) {
        margin-bottom: 20px;
    }
  </style>
</head>
<body>

<div class="main">
  <div class="header">
    {{ context.client_fio }}<br>
    № амб.карты {{ context.client_id }}
  </div>
  <br>

  <!-- Первичный осмотр -->

    {% if context.first_act.act_date %}
    <section class="section">
      <div class="header">Первичный осмотр</div>
      <div class="header">Дата {{ context.first_act.act_date }}</div>

      <div>Перенесенные и сопутствующие заболевания: {{ context.first_act.accompDiseases or 'не указаны' }}</div>
      <div>Данные объективного исследования:</div>
      <div>Внешний осмотр: {{ context.first_act.apsInpection or 'не указано' }}</div>

      <div align="center">
        {% if context.is_deciduous %}
            Молочные зубы
        {% else %}
            Постоянные зубы
        {% endif %}
      </div>
      <div>Прикус: {{ context.first_act.beet or 'не указан' }}</div>
      <div>Состояние слизистой оболочки полости рта, десен, альвеолярных отростков и неба: {{ context.first_act.oralCondition or 'не указано' }}</div>
      <div>Состояние слюнных желез: {{ context.first_act.glandCondition or 'не указано' }}</div>
      <div>Состояние лимфоузлов: {{ context.first_act.lymphNodes or 'не указано' }}</div>
      <div>Данные рентгеновских, лабораторных исследований: {{ context.first_act.researchData or 'нет данных' }}</div>
      <div>Развитие настоящего заболевания: {{ context.first_act.diseaseDevelopment or 'не указано' }}</div>
    </section>
    {% endif %}


    <section class="section">
        <!-- Таблица зубов -->
      <table width="100%" cellpadding="2" cellspacing="0">
        <!-- Верхние зубы -->
        <tr>
          <td class="center">Статус</td>
          {% for tooth_num in context.teeth_formula.top %}
            <td class="center">{{ context.teeth_formula.teeth_data[tooth_num].status if tooth_num in context.teeth_formula.teeth_data else '' }}</td>
          {% endfor %}
        </tr>
        <tr>
          <td class="center">Пародонтит, подвижность</td>
          {% for tooth_num in context.teeth_formula.top %}
            <td class="center">{{ context.teeth_formula.teeth_data[tooth_num].move if tooth_num in context.teeth_formula.teeth_data else '' }}</td>
          {% endfor %}
        </tr>
        <tr>
          <td class="center">Состояние</td>
          {% for tooth_num in context.teeth_formula.top %}
            <td class="center">{{ context.teeth_formula.teeth_data[tooth_num].condition if tooth_num in context.teeth_formula.teeth_data else '' }}</td>
          {% endfor %}
        </tr>
        <tr>
          <td class="center">Верх</td>
          {% for tooth_num in context.teeth_formula.top %}
            <td class="center">{{ tooth_num }}</td>
          {% endfor %}
        </tr>

        <!-- Нижние зубы -->
        <tr>
          <td class="center">Низ</td>
          {% for tooth_num in context.teeth_formula.bottom %}
            <td class="center">{{ tooth_num }}</td>
          {% endfor %}
        </tr>
        <tr>
          <td class="center">Состояние</td>
          {% for tooth_num in context.teeth_formula.bottom %}
            <td class="center">{{ context.teeth_formula.teeth_data[tooth_num].condition if tooth_num in context.teeth_formula.teeth_data else '' }}</td>
          {% endfor %}
        </tr>
        <tr>
          <td class="center">Пародонтит, подвижность</td>
          {% for tooth_num in context.teeth_formula.bottom %}
            <td class="center">{{ context.teeth_formula.teeth_data[tooth_num].move if tooth_num in context.teeth_formula.teeth_data else '' }}</td>
          {% endfor %}
        </tr>
        <tr>
          <td class="center">Статус</td>
          {% for tooth_num in context.teeth_formula.bottom %}
            <td class="center">{{ context.teeth_formula.teeth_data[tooth_num].status if tooth_num in context.teeth_formula.teeth_data else '' }}</td>
          {% endfor %}
        </tr>
      </table>
    </section>








  <!-- Вторичный осмотр -->
  {% for second_act in context.second_acts %}
    <section class="section">
      <div class="header"><b>{{second_act.action_type_name}}</b></div>
      <div class="header">Дата {{ second_act.act_date }}</div>

      {% if second_act.toothNumber %}
        <div><b>Зуб №:</b> {{ second_act.toothNumber }}</div>
      {% endif %}

      {% if second_act.cleaningList %}
        <div><b>Список зубов для чистки:</b> {{ second_act.cleaningList }}</div>
      {% endif %}

      {% if second_act.headAreas %}
        <div><b>Области головы, для которых проводится лечение:</b> {{ second_act.headAreas }}</div>
      {% endif %}

      {% if second_act.oralMucosa %}
        <div><b>Области слизистой полости рта:</b> {{ second_act.oralMucosa }}</div>
      {% endif %}

      {% if second_act.complaints %}
        <div><b>Жалобы:</b> {{ second_act.complaints }}</div>
      {% endif %}

      {% if second_act.anamnesis %}
        <div><b>Анамнез:</b> {{ second_act.anamnesis }}</div>
      {% endif %}

      {% if second_act.objectiveData %}
        <div><b>Объективные данные:</b> {{ second_act.objectiveData }}</div>
      {% endif %}

      {% if second_act.clinicalDiagnosis %}
        <div><b>Диагноз:</b> {{ second_act.clinicalDiagnosis }}</div>
      {% endif %}

      <div><b>МКБ-10:</b> {{ second_act.mkb }} {{ second_act.nameDiag or '' }}</div>

      {% if second_act.treatment %}
        <div><b>Лечение:</b> {{ second_act.treatment }}</div>
      {% endif %}

      {% if second_act.recommendations %}
        <div><b>Рекомендации:</b> {{ second_act.recommendations }}</div>
      {% endif %}
    </section>
  {% endfor %}



  <!-- Таблица услуг -->
  <table width="100%" cellpadding="3" cellspacing="0" border="1">
    <tr>
      <th width="1%" class="white-wrap">Код услуги</th>
      <th>Наименование услуги</th>
      <th width="1%" class="white-wrap">Цена</th>
      <th width="1%" class="white-wrap">Кол-во</th>
      <th width="1%" class="white-wrap">Сумма, руб</th>
    </tr>

    {% for service in context.services %}
      <tr>
        <td class="white-wrap center">{{ service.service_code or '' }}</td>
        <td>{{ service.service_name or '' }}</td>
        <td class="white-wrap center">{{ service.price or '' }}</td>
        <td class="white-wrap center">{{ service.amount or '' }}</td>
        <td class="white-wrap center">{{ service.sum or '' }}</td>
      </tr>
    {% endfor %}

    <tr>
      <td colspan="4" class="center"><b>Итого</b></td>
      <td class="center"><b>{{ context.all_sum or '0' }}</b></td>
    </tr>
  </table>
</div>
</body>
</html>
